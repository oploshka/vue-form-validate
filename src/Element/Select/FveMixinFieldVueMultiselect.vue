<template>
  <FveTemplateField>
    <Multiselect
      :name="name"
      :placeholder="placeholder"
      :readonly="readonly"
      :disabled="disabled"

      :required="required"
      autocomplete="off"

      :options="_optionList"


      selectLabel=""
      selectedLabel="Выбрано"
      deselectLabel="Удалить"
      deselectGroupLabel="Press enter to deselect group"
      selectGroupLabel="Press enter to select group"

      label="name"
      track-by="id"
      v-model="_value"
    >
      <template v-slot:noOptions>Пустой список</template>
      <template v-slot:noResult>По вашему запросу ничего не найдено.</template>
    </Multiselect>
  </FveTemplateField>
</template>

<script>

import FveMixinField from "@widgetFormValidate/src/Mixin/FveMixinField";
import FveMixinFieldSelect from '@widgetFormValidate/src/Mixin/FveMixinFieldSelect';

import Multiselect from 'vue-multiselect';

export default {
  mixins: [
    FveMixinField,
    FveMixinFieldSelect
  ],
  components: {
    Multiselect
  },
  props: {
    // значение по умолчанию (можно переопределить тип)
    value    : { type: Number, default: () => null },
  },
  methods: {

    // для строк -> приходит строка и преобразуем в DateTime
    prepareInput(value){
      return value;
    },
    // на выходе ожидается строка у нас DateTime
    prepareOutput(valueDateTime){
      if(valueDateTime === null) { return null; }
      return valueDateTime;
    },
    inputPrepareFormElement(valueDateTime) {
      this.inputFormElement( this.prepareOutput(valueDateTime) );
    },


    prepareValue($event) {
      return $event;
    },
    isEmpty(value) {
      return value === '';
    },
    // eslint-disable-next-line
    validateFunction(str) {
      return 'SUCCESS';
    },
  },
  computed: {
    valuePrepare() {
      return this.prepareInput(this.value);
    },
    _value: {
      get() {
        if(!this.value) {
          return null;
        }
        let v = this._optionList.find(option => option.id === this.value.toString());
        v =  v ? v : null;
        return v;
        /*
        this.value ?{
          id: this.value,
          name: '', // Не известное значение
        } : null;
         */
      },
      set(option){
        this.inputFormElement(option.id);
      }
    },
    _optionList() {
      return this.optionList.map((option) => {
        return {
          id: this.optionGetKey(option),
          name: this.optionGetName(option),
          // origin: option,
        };
      });
    }
  }
};
</script>


<style lang="scss" >
// TODO use scope
.fve {
  @import "~vue-multiselect/dist/vue-multiselect.min";
  /*
  .multiselect {
    margin: var(--fve-input--margin);
    .multiselect__select {
      width: 40px;
      height: 44px;
    }
    .multiselect__tags {
      min-height: 44px;
      padding: 8px 40px 0 16px;
      border: var(--fve-input--border);
      border-color: var(--fve-input--border-color);
      border-radius: var(--fve-input--border-radius);
      background-color: var(--fve-input--background-color);
      .multiselect__single {
        padding-top: 2px;
        padding-left: 0;
        margin-bottom: 0;
        font-family: var(--fve-input--font-family);
        font-size: var(--fve-input--font-size);
        font-weight: var(--fve-input--font-weight);
        color: var(--fve-input--font-color);
        background-color: rgba(0,0,0,0);
      }
    }
    .multiselect__input {
      min-height: 24px;
      font-family: var(--fve-input--font-family);
      font-size: var(--fve-input--font-size);
      font-weight: var(--fve-input--font-weight);
      color: var(--fve-input--font-color);
      background-color: rgba(0,0,0,0);
    }
    .multiselect__content-wrapper {
      background: var(--br-block-prime);
      border: 1px solid var(--br-block-prime);
    }
    .multiselect__option {
      color: #ACACAC;
      &--highlight {
        color: #343A40;
        background: var(--color-prime);
      }
      &--selected {
        color: #ACACAC;
        background: var(--br-block-sub);
        &.multiselect__option--highlight {
          color: var(--fve-input--font-color);
          background: var(--color-sub);
        }
      }
    }
  }
   */
}

</style>
